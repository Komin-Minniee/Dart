<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>EMS - Create Question</title>

    <style>
      body {
        font-family: Arial;
        background: #f4f6f9;
        margin: 0;
      }

      header {
        background: #1e3a8a;
        color: white;
        padding: 15px 25px;
        font-size: 18px;
      }

      .container {
        width: 90%;
        margin: 25px auto;
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      h3 {
        border-left: 4px solid #1e3a8a;
        padding-left: 10px;
        color: #1e3a8a;
      }

      .row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
      }

      .col {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      input,
      select,
      textarea {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }

      textarea {
        resize: vertical;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }

      th {
        background: #f1f1f1;
      }

      button {
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }

      .btn-add {
        background: #6b7280;
        color: white;
      }
      .btn-save {
        background: #16a34a;
        color: white;
      }
      .btn-remove {
        background: #dc2626;
        color: white;
      }

      .save-area {
        text-align: center;
        margin-top: 30px;
      }

      #saveMessage {
        text-align: center;
        margin-top: 50px;
      }

      #saveMessage button {
        margin: 10px;
        padding: 8px 15px;
        background: #1e3a8a;
        color: white;
      }
    </style>
  </head>

  <body>
    <header>Examination Management System - Question Creation</header>

    <div class="container" id="formContainer">
      <form id="questionForm">
        <!-- SUBJECT -->
        <h3>Subject (tbl_subjects)</h3>
        <div class="row">
          <div class="col">
            <label>subject_code</label>
            <input type="text" name="subject_code" required />
          </div>
          <div class="col">
            <label>subject_name</label>
            <input type="text" name="subject_name" required />
          </div>
          <div class="col">
            <label>status</label>
            <select name="subject_status">
              <option value="draft">draft</option>
              <option value="active">active</option>
              <option value="inactive">inactive</option>
              <option value="archived">archived</option>
            </select>
          </div>
        </div>

        <!-- SUBJECT DETAIL -->
        <h3>Subject Detail (tbl_subject_details)</h3>
        <div class="row">
          <div class="col">
            <label>year_id</label>
            <select name="year_id">
              <option value="1">2024-2025</option>
              <option value="2">2025-2026</option>
            </select>
          </div>
        </div>

        <!-- QUESTION -->
        <h3>Question (tbl_questions)</h3>
        <div class="row">
          <div class="col">
            <label>question_text</label>
            <textarea name="question_text" rows="3" required></textarea>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>score</label>
            <input type="number" name="score" value="1" />
          </div>
          <div class="col">
            <label>question_type</label>
            <select name="question_type">
              <option value="mcq">MCQ</option>
              <option value="true_false">True/False</option>
            </select>
          </div>
          <div class="col">
            <label>is_mandatory</label>
            <select name="is_mandatory">
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>
          <div class="col">
            <label>status</label>
            <select name="question_status">
              <option value="draft">draft</option>
              <option value="active">active</option>
              <option value="inactive">inactive</option>
              <option value="archived">archived</option>
            </select>
          </div>
        </div>

        <input type="hidden" name="created_by" value="1" />

        <!-- OPTIONS -->
        <h3>Options (tbl_options)</h3>

        <table>
          <thead>
            <tr>
              <th>option_order</th>
              <th>option_text</th>
              <th>is_correct</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="optionsBody"></tbody>
        </table>

        <br />
        <button type="button" class="btn-add" onclick="addOption()">
          + Add Option
        </button>

        <div class="save-area">
          <button type="button" class="btn-save" onclick="submitForm()">
            SAVE ALL
          </button>
        </div>
      </form>
    </div>

    <!-- Save Success Message -->
    <div class="container" id="saveMessage" style="display: none">
      <h2 style="color: green">âœ… Question saved successfully!</h2>
      <button onclick="addAnother()">Add Another Question</button>
      <button onclick="viewQuestions()">View Question List</button>
    </div>

    <!-- Question List -->
    <div class="container" id="questionListContainer" style="display: none">
      <h3>All Questions</h3>
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Subject</th>
            <th>Question Text</th>
            <th>Score</th>
            <th>Type</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="questionListBody"></tbody>
      </table>
    </div>

    <script>
      let optionIndex = 0;
      let questionList = []; // store saved questions

      function addOption(text = "", correct = false) {
        optionIndex++;
        const tbody = document.getElementById("optionsBody");

        const row = document.createElement("tr");
        const optionId =
          "option_" + Date.now() + Math.floor(Math.random() * 1000);
        row.innerHTML = `
        <td>
            <input type="number" name="option_order[]" value="${optionIndex}" readonly>
        </td>
        <td>
            <input type="text" name="option_text[]" value="${text}" required>
        </td>
        <td style="text-align:center;">
            <input type="radio" name="is_correct" value="${optionIndex}" ${correct ? "checked" : ""}>
        </td>
        <td>
            <button type="button" class="btn-remove" onclick="removeOption(this)">Remove</button>
        </td>
    `;
        tbody.appendChild(row);
      }

      function removeOption(btn) {
        btn.closest("tr").remove();
      }

      function submitForm() {
        const form = document.getElementById("questionForm");
        const options = document.getElementsByName("option_text[]");
        const correct = document.querySelector(
          "input[name='is_correct']:checked",
        );

        if (options.length < 2) {
          alert("At least 2 options required.");
          return;
        }

        if (!correct) {
          alert("Select correct answer.");
          return;
        }

        // Collect form data
        const optionsData = Array.from(options).map((opt, i) => ({
          order: i + 1,
          text: opt.value,
          is_correct: i + 1 == parseInt(correct.value) ? 1 : 0,
        }));

        const questionData = {
          subject_code: form.subject_code.value,
          subject_name: form.subject_name.value,
          subject_status: form.subject_status.value,
          year_id: form.year_id.value,
          question_text: form.question_text.value,
          score: form.score.value,
          question_type: form.question_type.value,
          is_mandatory: form.is_mandatory.value,
          question_status: form.question_status.value,
          created_by: form.created_by.value,
          options: optionsData,
        };

        // Save to local array (mock backend)
        questionList.push(questionData);

        // Show success message
        document.getElementById("formContainer").style.display = "none";
        document.getElementById("saveMessage").style.display = "block";
      }

      function addAnother() {
        document.getElementById("questionForm").reset();
        document.getElementById("optionsBody").innerHTML = "";
        optionIndex = 0;
        addOption();
        addOption();
        document.getElementById("saveMessage").style.display = "none";
        document.getElementById("formContainer").style.display = "block";
      }

      function viewQuestions() {
        const tbody = document.getElementById("questionListBody");
        tbody.innerHTML = "";

        questionList.forEach((q, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${q.subject_name}</td>
            <td>${q.question_text}</td>
            <td>${q.score}</td>
            <td>${q.question_type}</td>
            <td>${q.question_status}</td>
            <td>
                <button onclick="editQuestion(${index})">Edit</button>
                <button onclick="deleteQuestion(${index})">Delete</button>
            </td>
        `;
          tbody.appendChild(row);
        });

        document.getElementById("saveMessage").style.display = "none";
        document.getElementById("formContainer").style.display = "none";
        document.getElementById("questionListContainer").style.display =
          "block";
      }

      function editQuestion(index) {
        const q = questionList[index];
        const form = document.getElementById("questionForm");

        form.subject_code.value = q.subject_code;
        form.subject_name.value = q.subject_name;
        form.subject_status.value = q.subject_status;
        form.year_id.value = q.year_id;
        form.question_text.value = q.question_text;
        form.score.value = q.score;
        form.question_type.value = q.question_type;
        form.is_mandatory.value = q.is_mandatory;
        form.question_status.value = q.question_status;

        // Clear and reload options
        document.getElementById("optionsBody").innerHTML = "";
        optionIndex = 0;
        q.options.forEach((opt) => addOption(opt.text, opt.is_correct));

        document.getElementById("questionListContainer").style.display = "none";
        document.getElementById("formContainer").style.display = "block";

        // Remove old question on save
        questionList.splice(index, 1);
      }

      function deleteQuestion(index) {
        if (confirm("Are you sure to delete this question?")) {
          questionList.splice(index, 1);
          viewQuestions();
        }
      }

      // Add 2 default options on load
      addOption();
      addOption();
    </script>
  </body>
</html>
